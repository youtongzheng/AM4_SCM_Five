 subroutine set_eta(km, ks, ptop, ak, bk)

 implicit none
      integer,  intent(in)::  km           ! vertical dimension
      integer,  intent(out):: ks           ! number of pure p layers
      real, intent(out):: ak(km+1)
      real, intent(out):: bk(km+1)
      real, intent(out):: ptop         ! model top (Pa)
! local
      real a24(25),b24(25)            ! GFDL AM2L24
      real a32(33),b32(33)
      real a32w(33),b32w(33)
      real a33(34),b33(34)            ! miz: grid with enhanced surface-layer resolution
      real a48(49),b48(49)
      real a48x(49),b48x(49)
      real a55(56),b55(56)
      real a60(61),b60(61)
      real a61f(62),b61f(62)          !yzheng
      real a63(64),b63(64)
      real a64(65),b64(65)
      real a100(101),b100(101)
      real a101(102),b101(102)
      real a125(126),b125(126)
      real a203(204),b203(204)        ! ZNT 08/2020: ~20m resolution in PBL
#ifdef MARS_GCM
      real:: p0= 6.0E2
      real:: pc= 1.0e-3
      real a36(37),b36(37)            ! For Mars GCM
      real a28(29),b28(29)            !  Mars 28 levels 
#else
      real:: p0=1000.E2
      real:: pc=200.E2
#endif MARS_GCM 
      real pt, pint, lnpe, dlnp
      real press(km+1)
      integer  k

! Definition: press(i,j,k) = ak(k) + bk(k) * ps(i,j)

#ifdef MARS_GCM
!------- Mars vertical levels -----------------------------

  data a28 /     &
       2.0000000e-02,5.7381273e-02,1.9583981e-01,5.9229580e-01, &
       1.5660228e+00,2.4454965e+00,2.7683755e+00,2.8851692e+00, &
       2.9172228e+00,2.9087039e+00,2.8598939e+00,2.7687652e+00, &
       2.6327054e+00,2.4509219e+00,2.2266811e+00,1.9684681e+00, &
       1.6894832e+00,1.4055812e+00,1.1324258e+00,8.8289177e-01, &
       6.6548467e-01,4.8401020e-01,3.3824119e-01,2.2510704e-01, &
       1.3995719e-01,7.7611554e-02,3.3085503e-02,2.0000000e-03, &
       0.0000000e+00  /

  data b28 /      &
       0.0000000e+00,0.0000000e+00,0.0000000e+00,0.0000000e+00, &
       0.0000000e+00,1.9366394e-03,7.4419133e-03,1.6227267e-02, &
       2.7075192e-02,4.3641000e-02,6.8106804e-02,1.0280240e-01, &
       1.4971954e-01,2.0987133e-01,2.8270233e-01,3.6581610e-01, &
       4.5520230e-01,5.4593599e-01,6.3310970e-01,7.1267629e-01, &
       7.8196151e-01,8.3977530e-01,8.8620345e-01,9.2223168e-01, &
       9.4934533e-01,9.6919618e-01,9.8337259e-01,9.9326941e-01, &
       1.0000000e+00  /


  data a36 /      &
  2.0000000000e-03,  6.3299931399e-03,  1.2501646444e-02, & 
  2.4215113043e-02,  4.6000346612e-02,  8.5702012910e-02, & 
  1.5659441036e-01,  2.8061882660e-01,  4.9318818941e-01, & 
  8.5008792314e-01,  1.4370449074e+00,  2.0054945771e+00, & 
  2.3335916338e+00,  2.5221957520e+00,  2.6264602874e+00, & 
  2.6762480591e+00,  2.6870173757e+00,  2.6657174771e+00, & 
  2.6140573091e+00,  2.5304052915e+00,  2.4110051828e+00, &
  2.2508885698e+00,  2.0446940567e+00,  1.8074358726e+00, & 
  1.5511877409e+00,  1.2904762231e+00,  1.0396626704e+00, & 
  8.1055438393e-01,  6.1095195817e-01,  4.4434410651e-01, & 
  3.1051916267e-01,  2.0665632614e-01,  1.2848513437e-01, & 
  7.1249514632e-02,  3.0373097709e-02,  2.1040298410e-16, & 
  0.0000000000e+00  /
  
  data b36 /      &
  0.0000000000e+00,  0.0000000000e+00,  0.0000000000e+00, & 
  0.0000000000e+00,  0.0000000000e+00,  0.0000000000e+00, & 
  0.0000000000e+00,  0.0000000000e+00,  0.0000000000e+00, & 
  0.0000000000e+00,  0.0000000000e+00,  6.2833541661e-04, & 
  2.5671934940e-03,  6.0923860938e-03,  1.1725248117e-02, & 
  2.0238695380e-02,  3.2676843179e-02,  5.0373898012e-02, & 
  7.4959525687e-02,  1.0833815470e-01,  1.5263019875e-01, & 
  2.1006506655e-01,  2.8281982789e-01,  3.6584598427e-01, & 
  4.5513763376e-01,  5.4577516959e-01,  6.3285639147e-01, & 
  7.1233851133e-01,  7.8155013540e-01,  8.3930250332e-01, & 
  8.8568132228e-01,  9.2167127115e-01,  9.4875609753e-01, & 
  9.6858585131e-01,  9.8274719475e-01,  9.9326941371e-01, & 
  1.0000000000e+00  /

#endif MARS_GCM 

!-----------------------------------------------
! GFDL AM2-L24: modified by SJL at the model top
!-----------------------------------------------
!     data a24 /  100.0000,  1050.0000,  3474.7942,  7505.5556, 12787.2428,   &
      data a24 /  100.0000,   903.4465,  3474.7942,  7505.5556, 12787.2428,   &
                19111.3683, 21854.9274, 22884.1866, 22776.3058, 21716.1604,   &
                20073.2963, 18110.5123, 16004.7832, 13877.6253, 11812.5452,   &
                 9865.8840,  8073.9726,  6458.0834,  5027.9899,  3784.6085,   &
                 2722.0086,  1828.9752,  1090.2396,   487.4595,     0.0000    /

      data b24 / 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000,       &
                 0.0000000, 0.0435679, 0.1102275, 0.1922249, 0.2817656,       &
                 0.3694997, 0.4532348, 0.5316253, 0.6038733, 0.6695556,       &
                 0.7285176, 0.7808017, 0.8265992, 0.8662148, 0.9000406,       &
                 0.9285364, 0.9522140, 0.9716252, 0.9873523, 1.0000000        /
! High-resolution troposphere setup
! Revised Apr 14, 2004: PINT = 245.027 mb
      data a32/100.00000,     400.00000,     818.60211, &
              1378.88653,    2091.79519,    2983.64084, &
              4121.78960,    5579.22148,    7419.79300, &
              9704.82578,   12496.33710,   15855.26306, &
             19839.62499,   24502.73262,   28177.10152, &
             29525.28447,   29016.34358,   27131.32792, &
             24406.11225,   21326.04907,   18221.18357, &
             15275.14642,   12581.67796,   10181.42843, &
              8081.89816,    6270.86956,    4725.35001, &
              3417.39199,    2317.75459,    1398.09473, &
               632.49506,       0.00000,       0.00000  /

      data b32/0.00000,       0.00000,       0.00000, &
               0.00000,       0.00000,       0.00000, &
               0.00000,       0.00000,       0.00000, &
               0.00000,       0.00000,       0.00000, &
               0.00000,       0.00000,       0.01711, &
               0.06479,       0.13730,       0.22693, &
               0.32416,       0.42058,       0.51105, &
               0.59325,       0.66628,       0.73011, &
               0.78516,       0.83217,       0.87197, &
               0.90546,       0.93349,       0.95685, &
               0.97624,       0.99223,       1.00000  /

!---------------------
! Wilson's 32L settings:
!---------------------
! Top changed to 0.01 mb
      data a32w/  1.00,       26.6378,     84.5529,     228.8592,   & 
                539.9597,   1131.7087,   2141.8082,    3712.0454,   &
               5963.5317,   8974.1873,  12764.5388,   17294.5911,   &
              20857.7007,  22221.8651,  22892.7202,   22891.1641,   &
              22286.0724,  21176.0846,  19673.0671,   17889.0989,   &
              15927.5060,  13877.6239,  11812.5474,    9865.8830,   &
               8073.9717,   6458.0824,   5027.9893,    3784.6104,   &
               2722.0093,   1828.9741,   1090.2397,     487.4575,   &
               0.0000 /
         
      data b32w/ 0.0000,   0.0000,   0.0000,    0.0000,       &
                0.0000,   0.0000,   0.0000,    0.0000,       &
                0.0000,   0.0000,   0.0000,    0.0000,       &
                0.0159,   0.0586,   0.1117,    0.1734,       &
                0.2415,   0.3137,   0.3878,    0.4619,       &
                0.5344,   0.6039,   0.6696,    0.7285,       &
                0.7808,   0.8266,   0.8662,    0.9000,       &
                0.9285,   0.9522,   0.9716,    0.9874,       &
                1.0000 /
!miz
      data a33/100.00000,     400.00000,     818.60211,  &
              1378.88653,    2091.79519,    2983.64084,  &
              4121.78960,    5579.22148,    6907.19063,  &
              7735.78639,    8197.66476,    8377.95525,  &
              8331.69594,    8094.72213,    7690.85756,  &
              7139.01788,    6464.80251,    5712.35727,  &
              4940.05347,    4198.60465,    3516.63294,  &
              2905.19863,    2366.73733,    1899.19455,  &
              1497.78137,    1156.25252,     867.79199,  &
               625.59324,     426.21322,     264.76613,  &
               145.06646,      60.00000,      15.00000,  &
                 0.00000  /

      data b33/0.00000,       0.00000,       0.00000,  &
               0.00000,       0.00000,       0.00000,  &
               0.00000,       0.00000,       0.00513,  &
               0.01969,       0.04299,       0.07477,  &
               0.11508,       0.16408,       0.22198,  &
               0.28865,       0.36281,       0.44112,  &
               0.51882,       0.59185,       0.65810,  &
               0.71694,       0.76843,       0.81293,  &
               0.85100,       0.88331,       0.91055,  &
               0.93331,       0.95214,       0.96750,  &
               0.97968,       0.98908,       0.99575,  &
               1.00000  /
!miz

! High trop-resolution (Feb 2004)
           data a48x/                                &
                   1.00000,       2.69722,       5.17136,   &
                   8.89455,      14.24790,      22.07157,   &
                  33.61283,      50.48096,      74.79993,   &
                 109.40055,     158.00460,     225.44108,   &
                 317.89560,     443.19350,     611.11558,   &
                 833.74392,    1125.83405,    1505.20759,   &
                1993.15829,    2614.86254,    3399.78420,   &
                4382.06240,    5600.87014,    7100.73115,   &
                8931.78242,   11149.97021,   13817.16841,   &
               17001.20930,   20775.81856,   23967.33875,   &
               25527.64563,   25671.22552,   24609.29622,   &
               22640.51220,   20147.13482,   17477.63530,   &
               14859.86462,   12414.92533,   10201.44191,   &
                8241.50255,    6534.43202,    5066.17865,   &
                3815.60705,    2758.60264,    1870.64631,   &
                1128.33931,     510.47983,       0.00000,   &
                   0.00000  /

           data b48x/              &
                   0.00000,       0.00000,       0.00000,   &
                   0.00000,       0.00000,       0.00000,   &
                   0.00000,       0.00000,       0.00000,   &
                   0.00000,       0.00000,       0.00000,   &
                   0.00000,       0.00000,       0.00000,   &
                   0.00000,       0.00000,       0.00000,   &
                   0.00000,       0.00000,       0.00000,   &
                   0.00000,       0.00000,       0.00000,   &
                   0.00000,       0.00000,       0.00000,   &
                   0.00000,       0.00000,       0.01253,   &
                   0.04887,       0.10724,       0.18455,   &
                   0.27461,       0.36914,       0.46103,   &
                   0.54623,       0.62305,       0.69099,   &
                   0.75016,       0.80110,       0.84453,   &
                   0.88127,       0.91217,       0.93803,   &
                   0.95958,       0.97747,       0.99223,   &
                   1.00000   /

!     John Wilson 48 stratosphere 
      data a48/  0.2000,       0.4643,       1.1978,        2.8806,  &
                 6.4919,      13.7758,      27.6477,       52.6975,  &
                95.7569,     166.4702,     277.7878,      446.2903,  &
               692.2605,    1039.4396,    1514.4422,     2145.8457,  &
              2963.0124,    3994.7360,    5267.8238,     6805.7330,  &
              8627.3676,   10746.1233,   13169.2374,    15897.4710,  &
             18925.1187,   20785.0282,   21756.8874,    22456.5487,  &
             22864.2127,   22968.7603,   22767.3528,    22264.7045,  &
             21472.1263,   20406.4316,   19088.7860,    17543.5673,  &
             15797.2892,   13877.6239,   11812.5474,     9865.8830,  &
              8073.9717,    6458.0824,    5027.9893,     3784.6104,  &
              2722.0093,    1828.9741,    1090.2397,      487.4575,  &
                 0.0000 /


        data b48/       0.00000,   0.00000,   0.00000,    0.00000,   &
                        0.00000,   0.00000,   0.00000,    0.00000,   &
                        0.00000,   0.00000,   0.00000,    0.00000,   &
                        0.00000,   0.00000,   0.00000,    0.00000,   &
                        0.00000,   0.00000,   0.00000,    0.00000,   &
                        0.00000,   0.00000,   0.00000,    0.00000,   &
                        0.00000,   0.01436,   0.04016,    0.07108,   &
                        0.10707,   0.14795,   0.19344,    0.24318,   &
                        0.29672,   0.35358,   0.41326,    0.47522,   &
                        0.53893,   0.60387,   0.66956,    0.72852,   &
                        0.78080,   0.82660,   0.86621,    0.90004,   &
                        0.92854,   0.95221,   0.97163,    0.98735,   &
                        1.00000  /


      data a55/ 1.00000,     2.00000,       3.27000,       &
              4.75850,       6.60000,       8.93450,       &
             11.97030,      15.94950,      21.13490,       &
             27.85260,      36.50410,      47.58060,       &
             61.67790,      79.51340,     101.94420,       &
            130.05080,     165.07920,     208.49720,       &
            262.02120,     327.64330,     407.65670,       &
            504.68050,     621.68000,     761.98390,       &
            929.29430,    1127.68880,    1364.33920,       &
           1645.70720,    1979.15540,    2373.03610,       &
           2836.78160,    3380.99550,    4017.54170,       &
           4764.39320,    5638.79380,    6660.33770,       &
           7851.22980,    9236.56610,   10866.34270,       &
          12783.70000,   15039.30000,   17693.00000,       &
          20119.20876,   21686.49129,   22436.28749,       &
          22388.46844,   21541.75227,   19873.78342,       &
          17340.31831,   13874.44006,   10167.16551,       &
           6609.84274,    3546.59643,    1270.49390,       &
              0.00000,       0.00000   /

      data b55 /0.00000,       0.00000,       0.00000,     &
                0.00000,       0.00000,       0.00000,     & 
                0.00000,       0.00000,       0.00000,     &
                0.00000,       0.00000,       0.00000,     &
                0.00000,       0.00000,       0.00000,     &
                0.00000,       0.00000,       0.00000,     &
                0.00000,       0.00000,       0.00000,     &
                0.00000,       0.00000,       0.00000,     &
                0.00000,       0.00000,       0.00000,     &
                0.00000,       0.00000,       0.00000,     &
                0.00000,       0.00000,       0.00000,     &
                0.00000,       0.00000,       0.00000,     &
                0.00000,       0.00000,       0.00000,     &
                0.00000,       0.00000,       0.00000,     &
                0.00696,       0.02801,       0.06372,     &
                0.11503,       0.18330,       0.27033,     &
                0.37844,       0.51046,       0.64271,     &
                0.76492,       0.86783,       0.94329,     &
                0.98511,       1.00000  /

      data a60/                                                    &
               0.17861,      1.08051,      3.96471,       9.75160, &
              19.81658,     36.69595,     62.55057,      99.19962, &
             147.92505,    209.47487,    284.22571,     372.41721, &
             474.37835,    590.70236,    722.36063,     870.76746, &
            1037.81388,   1225.88773,   1437.89246,    1677.27266, &
            1948.05064,   2254.87627,   2603.09094,    2998.80592, &
            3448.99523,   3961.60289,   4545.66416,    5211.44017, &
            5970.56440,   6836.19818,   7823.19060,    8948.23510, &
           10230.01066,  11689.28975,  13348.98686,   15234.11106, &
           17371.57323,  19789.78458,  22005.56455,   23550.11512, &
           24468.58332,  24800.54880,  24582.44507,   23849.99962, &
           22640.51974,  20994.73715,  18957.84873,   16579.41323, &
           14080.07103,  11753.63092,   9651.69963,    7793.80093, &
            6176.90628,   4787.42760,   3605.04975,    2605.98607, &
            1766.83282,   1065.61312,    482.26201,       0.00000, &
               0.00000   / 

        data b60/                                       &
             0.00000,   0.00000,   0.00000,   0.00000,  &
             0.00000,   0.00000,   0.00000,   0.00000,  &
             0.00000,   0.00000,   0.00000,   0.00000,  &
             0.00000,   0.00000,   0.00000,   0.00000,  &
             0.00000,   0.00000,   0.00000,   0.00000,  &
             0.00000,   0.00000,   0.00000,   0.00000,  &
             0.00000,   0.00000,   0.00000,   0.00000,  &
             0.00000,   0.00000,   0.00000,   0.00000,  &
             0.00000,   0.00000,   0.00000,   0.00000,  &
             0.00000,   0.00000,   0.00506,   0.02008,  &
             0.04490,   0.07936,   0.12326,   0.17634,  &
             0.23820,   0.30827,   0.38581,   0.46989,  &
             0.55393,   0.62958,   0.69642,   0.75458,  &
             0.80463,   0.84728,   0.88335,   0.91368,  &
             0.93905,   0.96020,   0.97775,   0.99223,  &
             1.00000  /  

!yzheng The following L61 setting corresponds to five simulation with 2 added layers
        data a61f/100.000000000000,        400.000000000000,        818.602110000000,      &
              1378.88653000000,        2091.79519000000,        2983.64084000000,      &
              4121.78960000000,        5579.22148000000,        6907.19063000000,      &
              7735.78639000000,        8197.66476000000,        8377.95525000000,      &
              8331.69594000000,        8094.72213000000,        7690.85756000000,      &
              7139.01788000000,        6464.80251000000,        5712.35727000000,      &
              5454.92267000000,        5197.48807000000,        4940.05347000000,      &
              4692.90386333333,        4445.75425666667,        4198.60465000000,      &
              3971.28074666667,        3743.95684333333,        3516.63294000000,      &
              3312.82150333333,        3109.01006666667,        2905.19863000000,      &
              2725.71153000000,        2546.22443000000,        2366.73733000000,      &
              2210.88973666667,        2055.04214333333,        1899.19455000000,      &
              1765.39015666667,        1631.58576333333,        1497.78137000000,      &
              1383.93842000000,        1270.09547000000,        1156.25252000000,      &
              1060.09901000000,        963.945500000000,        867.791990000000,      &
              787.059073333333,        706.326156666667,        625.593240000000,      &
              559.133233333333,        492.673226666667,        426.213220000000,      &
              372.397523333333,        318.581826666667,        264.766130000000,      &
              224.866240000000,        184.966350000000,        145.066460000000,      &
              116.710973333333,        88.3554866666667,        60.0000000000000,      &
              15.0000000000000,       0.0000 /

     data b61f/0.00000,  0.00000,  0.00000,    &
              0.00000,       0.00000,       0.00000,    &
              0.00000,       0.00000,       0.00513,    &
              0.01969,       0.04299,       0.07477,    &
              0.115080000000000,       0.164080000000000,       0.221980000000000,    &
              0.288650000000000,       0.362810000000000,       0.441120000000000,    &
              0.467020000000000,       0.492920000000000,       0.518820000000000,    &
              0.543163333333333,       0.567506666666667,       0.591850000000000,    &
              0.613933333333333,       0.636016666666667,       0.658100000000000,    &
              0.677713333333333,       0.697326666666667,       0.716940000000000,    &
              0.734103333333333,       0.751266666666667,       0.768430000000000,    &
              0.783263333333333,       0.798096666666667,       0.812930000000000,    &
              0.825620000000000,       0.838310000000000,       0.851000000000000,    &
              0.861770000000000,       0.872540000000000,       0.883310000000000,    &
              0.892390000000000,       0.901470000000000,       0.910550000000000,    &
              0.918136666666667,       0.925723333333333,       0.933310000000000,    &
              0.939586666666667,       0.945863333333333,       0.952140000000000,    &
              0.957260000000000,       0.962380000000000,       0.967500000000000,    &
              0.971560000000000,       0.975620000000000,       0.979680000000000,    &
              0.982813333333333,       0.985946666666667,       0.989080000000000,    &
              0.995750000000000,        1.00000000000000/

! The following L63 setting is the same as NCEP GFS's L64 except the top
! 3 layers
      data a63/64.247,       137.790,       221.958,      &
              318.266,       428.434,       554.424,      &
              698.457,       863.05803,    1051.07995,    &
             1265.75194,    1510.71101,    1790.05098,    &
             2108.36604,    2470.78817,    2883.03811,    &
             3351.46002,    3883.05187,    4485.49315,    &
             5167.14603,    5937.04991,    6804.87379,    &
             7780.84698,    8875.64338,   10100.20534,    &
            11264.35673,   12190.64366,   12905.42546,    &
            13430.87867,   13785.88765,   13986.77987,    &
            14047.96335,   13982.46770,   13802.40331,    &
            13519.33841,   13144.59486,   12689.45608,    &
            12165.28766,   11583.57006,   10955.84778,    &
            10293.60402,    9608.08306,    8910.07678,    &
             8209.70131,    7516.18560,    6837.69250,    &
             6181.19473,    5552.39653,    4955.72632,    &
             4394.37629,    3870.38682,    3384.76586,    &
             2937.63489,    2528.37666,    2155.78385,    &
             1818.20722,    1513.68173,    1240.03585,    &
              994.99144,     776.23591,     581.48797,    &
              408.53400,     255.26520,     119.70243, 0. /

      data b63/0.00000,       0.00000,       0.00000,    &
               0.00000,       0.00000,       0.00000,    &
               0.00000,       0.00000,       0.00000,    &
               0.00000,       0.00000,       0.00000,    &
               0.00000,       0.00000,       0.00000,    &
               0.00000,       0.00000,       0.00000,    &
               0.00000,       0.00000,       0.00000,    &
               0.00000,       0.00000,       0.00000,    &
               0.00201,       0.00792,       0.01755,    &
               0.03079,       0.04751,       0.06761,    &
               0.09097,       0.11746,       0.14690,    &
               0.17911,       0.21382,       0.25076,    &
               0.28960,       0.32994,       0.37140,    &
               0.41353,       0.45589,       0.49806,    &
               0.53961,       0.58015,       0.61935,    &
               0.65692,       0.69261,       0.72625,    &
               0.75773,       0.78698,       0.81398,    &
               0.83876,       0.86138,       0.88192,    &
               0.90050,       0.91722,       0.93223,    &
               0.94565,       0.95762,       0.96827,    &
               0.97771,       0.98608,       0.99347,  1./


      data a64/1.00000,       3.90000,       8.70000,      &
              15.42000,      24.00000,      34.50000,      &
              47.00000,      61.50000,      78.60000,      &
              99.13500,     124.12789,     154.63770,      &
             191.69700,     236.49300,     290.38000,      &
             354.91000,     431.82303,     523.09300,      &
             630.92800,     757.79000,     906.45000,      &
            1079.85000,    1281.00000,    1515.00000,      &
            1788.00000,    2105.00000,    2470.00000,      &
            2889.00000,    3362.00000,    3890.00000,      &
            4475.00000,    5120.00000,    5830.00000,      &
            6608.00000,    7461.00000,    8395.00000,      &
            9424.46289,   10574.46880,   11864.80270,      &
           13312.58890,   14937.03710,   16759.70700,      &
           18804.78710,   21099.41210,   23674.03710,      &
           26562.82810,   29804.11720,   32627.31640,      &
           34245.89840,   34722.28910,   34155.19920,      &
           32636.50390,   30241.08200,   27101.44920,      &
           23362.20700,   19317.05270,   15446.17090,      &
           12197.45210,    9496.39941,    7205.66992,      &
            5144.64307,    3240.79346,    1518.62134,      &
               0.00000,       0.00000 /

      data b64/0.00000,       0.00000,       0.00000,      &
               0.00000,       0.00000,       0.00000,      &
               0.00000,       0.00000,       0.00000,      &
               0.00000,       0.00000,       0.00000,      &
               0.00000,       0.00000,       0.00000,      &
               0.00000,       0.00000,       0.00000,      &
               0.00000,       0.00000,       0.00000,      &
               0.00000,       0.00000,       0.00000,      &
               0.00000,       0.00000,       0.00000,      &
               0.00000,       0.00000,       0.00000,      &
               0.00000,       0.00000,       0.00000,      &
               0.00000,       0.00000,       0.00000,      &
               0.00000,       0.00000,       0.00000,      &
               0.00000,       0.00000,       0.00000,      &
               0.00000,       0.00000,       0.00000,      &
               0.00000,       0.00000,       0.00813,      &
               0.03224,       0.07128,       0.12445,      &
               0.19063,       0.26929,       0.35799,      &
               0.45438,       0.55263,       0.64304,      &
               0.71703,       0.77754,       0.82827,      &
               0.87352,       0.91502,       0.95235,      &
               0.98511,       1.00000 /
!
! Ultra high troposphere resolution
      data a100/100.00000,     300.00000,     800.00000,   &
               1762.35235,    3106.43596,    4225.71874,   &
               4946.40525,    5388.77387,    5708.35540,   &
               5993.33124,    6277.73673,    6571.49996,   &
               6877.05339,    7195.14327,    7526.24920,   &
               7870.82981,    8229.35361,    8602.30193,   &
               8990.16936,    9393.46399,    9812.70768,   &
              10248.43625,   10701.19980,   11171.56286,   &
              11660.10476,   12167.41975,   12694.11735,   &
              13240.82253,   13808.17600,   14396.83442,   &
              15007.47066,   15640.77407,   16297.45067,   &
              16978.22343,   17683.83253,   18415.03554,   &
              19172.60771,   19957.34218,   20770.05022,   &
              21559.14829,   22274.03147,   22916.87519,   &
              23489.70456,   23994.40187,   24432.71365,   &
              24806.25734,   25116.52754,   25364.90190,   &
              25552.64670,   25680.92203,   25750.78675,   &
              25763.20311,   25719.04113,   25619.08274,   &
              25464.02630,   25254.49482,   24991.06137,   &
              24674.32737,   24305.11235,   23884.79781,   &
              23415.77059,   22901.76510,   22347.84738,   &
              21759.93950,   21144.07284,   20505.73136,   &
              19849.54271,   19179.31412,   18498.23400,   &
              17809.06809,   17114.28232,   16416.10343,   &
              15716.54833,   15017.44246,   14320.43478,   &
              13627.01116,   12938.50682,   12256.11762,   &
              11580.91062,   10913.83385,   10255.72526,   &
               9607.32122,    8969.26427,    8342.11044,   &
               7726.33606,    7122.34405,    6530.46991,   &
               5950.98721,    5384.11279,    4830.01153,   &
               4288.80090,    3760.55514,    3245.30920,   &
               2743.06250,    2253.78294,    1777.41285,   &
               1313.88054,     863.12371,     425.13088,   &
                  0.00000,       0.00000  /


      data b100/0.00000,       0.00000,       0.00000,   &
                0.00000,       0.00000,       0.00000,   &
                0.00000,       0.00000,       0.00000,   &
                0.00000,       0.00000,       0.00000,   &
                0.00000,       0.00000,       0.00000,   &
                0.00000,       0.00000,       0.00000,   &
                0.00000,       0.00000,       0.00000,   &
                0.00000,       0.00000,       0.00000,   &
                0.00000,       0.00000,       0.00000,   &
                0.00000,       0.00000,       0.00000,   &
                0.00000,       0.00000,       0.00000,   &
                0.00000,       0.00000,       0.00000,   &
                0.00000,       0.00000,       0.00000,   &
                0.00052,       0.00209,       0.00468,   &
                0.00828,       0.01288,       0.01849,   &
                0.02508,       0.03266,       0.04121,   &
                0.05075,       0.06126,       0.07275,   &
                0.08521,       0.09866,       0.11308,   &
                0.12850,       0.14490,       0.16230,   &
                0.18070,       0.20009,       0.22042,   &
                0.24164,       0.26362,       0.28622,   &
                0.30926,       0.33258,       0.35605,   &
                0.37958,       0.40308,       0.42651,   &
                0.44981,       0.47296,       0.49591,   &
                0.51862,       0.54109,       0.56327,   &
                0.58514,       0.60668,       0.62789,   &
                0.64872,       0.66919,       0.68927,   &
                0.70895,       0.72822,       0.74709,   &
                0.76554,       0.78357,       0.80117,   &
                0.81835,       0.83511,       0.85145,   &
                0.86736,       0.88286,       0.89794,   &
                0.91261,       0.92687,       0.94073,   &
                0.95419,       0.96726,       0.97994,   &
                0.99223,       1.00000  /

! Resolution for CLUBB
      data a101/0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000,  &
                0.0000000,  0.0000000,  0.0000000 /


      data b101/0.0000000,  0.00903,    0.0219447, &
                0.0377893,  0.0761745,  0.1127318, &
                0.1475483,  0.1807068,  0.2122864, &
                0.2423622,  0.2710059,  0.2982855, &
                0.3242662,  0.3490096,  0.3725748, &
                0.3950179,  0.4163923,  0.4367488, &
                0.4561360,  0.4745999,  0.4921846, &
                0.5089320,  0.5248819,  0.5400723, &
                0.5545393,  0.5683174,  0.5814393, &
                0.5939364,  0.6058385,  0.6171737, &
                0.6279693,  0.6382507,  0.6480426, &
                0.6573681,  0.6664221,  0.6752123, &
                0.6837466,  0.6920323,  0.7000766, &
                0.7078867,  0.7154693,  0.7228311, &
                0.7299784,  0.7369176,  0.7436547, &
                0.7501955,  0.7565458,  0.7627112, &
                0.7686970,  0.7745085,  0.7801507, &
                0.7856285,  0.7909468,  0.7961102, &
                0.8011231,  0.8059901,  0.8107153, &
                0.8153029,  0.8197569,  0.8240811, &
                0.8282794,  0.8323554,  0.8363127, &
                0.8401547,  0.8440143,  0.8478916, &
                0.8517868,  0.8556998,  0.8596308, &
                0.8635799,  0.8675471,  0.8715326, &
                0.8755363,  0.8795584,  0.8835991, &
                0.8876583,  0.8917361,  0.8958327, &
                0.8999481,  0.9040824,  0.9082356, &
                0.9124080,  0.9165995,  0.9208103, &
                0.9250404,  0.9292900,  0.9335591, &
                0.9378478,  0.9421562,  0.9464844, &
                0.9508324,  0.9552005,  0.9595886, &
                0.9639969,  0.9684254,  0.9728743, &
                0.9773436,  0.9818335,  0.9863439, &
                0.9908751,  0.9954271,  1.0000000/

! ZNT 08/2020: L203: double the resolution of L101 with
!                    two pure p-level at the top (100 and 200 Pa)
     data a203/100.00000, 200.00000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000, &
               0.0000000, 0.0000000, 0.0000000, 0.0000000/

     data b203/0.0000000, 0.0000000, 0.0040724, 0.0090300, &
               0.0150371, 0.0219447, 0.0288420, 0.0377893, &
               0.0551046, 0.0761745, 0.0946761, 0.1127318, &
               0.1303523, 0.1475483, 0.1643297, 0.1807068, &
               0.1966892, 0.2122864, 0.2275077, 0.2423622, &
               0.2568587, 0.2710059, 0.2848120, 0.2982855, &
               0.3114343, 0.3242662, 0.3367888, 0.3490096, &
               0.3609359, 0.3725748, 0.3839332, 0.3950179, &
               0.4058354, 0.4163923, 0.4266947, 0.4367488, &
               0.4465606, 0.4561360, 0.4654805, 0.4745999, &
               0.4834995, 0.4921846, 0.5006604, 0.5089320, &
               0.5170042, 0.5248819, 0.5325697, 0.5400723, &
               0.5473940, 0.5545393, 0.5615124, 0.5683174, &
               0.5749584, 0.5814393, 0.5877640, 0.5939364, &
               0.5999600, 0.6058385, 0.6115752, 0.6171737, &
               0.6226373, 0.6279693, 0.6331727, 0.6382507, &
               0.6432064, 0.6480426, 0.6527510, 0.6573681, &
               0.6619285, 0.6664221, 0.6708497, 0.6752123, &
               0.6795110, 0.6837466, 0.6879201, 0.6920323, &
               0.6960842, 0.7000766, 0.7040105, 0.7078867, &
               0.7117060, 0.7154693, 0.7191774, 0.7228311, &
               0.7264312, 0.7299784, 0.7334736, 0.7369176, &
               0.7403110, 0.7436547, 0.7469493, 0.7501955, &
               0.7533941, 0.7565458, 0.7596513, 0.7627112, &
               0.7657262, 0.7686970, 0.7716242, 0.7745085, &
               0.7773505, 0.7801507, 0.7829098, 0.7856285, &
               0.7883073, 0.7909468, 0.7935476, 0.7961102, &
               0.7986352, 0.8011231, 0.8035746, 0.8059901, &
               0.8083702, 0.8107153, 0.8130260, 0.8153029, &
               0.8175464, 0.8197569, 0.8219350, 0.8240811, &
               0.8261958, 0.8282794, 0.8303325, 0.8323554, &
               0.8343487, 0.8363127, 0.8382397, 0.8401547, &
               0.8420823, 0.8440143, 0.8459507, 0.8478916, &
               0.8498370, 0.8517868, 0.8537411, 0.8556998, &
               0.8576630, 0.8596308, 0.8616031, 0.8635799, &
               0.8655612, 0.8675471, 0.8695376, 0.8715326, &
               0.8735322, 0.8755363, 0.8775450, 0.8795584, &
               0.8815764, 0.8835991, 0.8856264, 0.8876583, &
               0.8896949, 0.8917361, 0.8937820, 0.8958327, &
               0.8978880, 0.8999481, 0.9020129, 0.9040824, &
               0.9061566, 0.9082356, 0.9103194, 0.9124080, &
               0.9145014, 0.9165995, 0.9187025, 0.9208103, &
               0.9229229, 0.9250404, 0.9271628, 0.9292900, &
               0.9314221, 0.9335591, 0.9357010, 0.9378478, &
               0.9399995, 0.9421562, 0.9443178, 0.9464844, &
               0.9486559, 0.9508324, 0.9530139, 0.9552005, &
               0.9573920, 0.9595886, 0.9617902, 0.9639969, &
               0.9662086, 0.9684254, 0.9706473, 0.9728743, &
               0.9751064, 0.9773436, 0.9795860, 0.9818335, &
               0.9840861, 0.9863439, 0.9886069, 0.9908751, &
               0.9931485, 0.9954271, 0.9977109, 1.0000000/       


! IFS-like L125(top 12 levels removed from IFSL137)
       data a125/   64.,                                                                          &
                               86.895882,   107.415741,   131.425507,   159.279404,   191.338562, &
                227.968948,   269.539581,   316.420746,   368.982361,   427.592499,   492.616028, &
                564.413452,   643.339905,   729.744141,   823.967834,   926.344910,  1037.201172, &
               1156.853638,  1285.610352,  1423.770142,  1571.622925,  1729.448975,  1897.519287, &
               2076.095947,  2265.431641,  2465.770508,  2677.348145,  2900.391357,  3135.119385, &
               3381.743652,  3640.468262,  3911.490479,  4194.930664,  4490.817383,  4799.149414, &
               5119.895020,  5452.990723,  5798.344727,  6156.074219,  6526.946777,  6911.870605, &
               7311.869141,  7727.412109,  8159.354004,  8608.525391,  9076.400391,  9562.682617, &
              10065.978516, 10584.631836, 11116.662109, 11660.067383, 12211.547852, 12766.873047, &
              13324.668945, 13881.331055, 14432.139648, 14975.615234, 15508.256836, 16026.115234, &
              16527.322266, 17008.789063, 17467.613281, 17901.621094, 18308.433594, 18685.718750, &
              19031.289063, 19343.511719, 19620.042969, 19859.390625, 20059.931641, 20219.664063, &
              20337.863281, 20412.308594, 20442.078125, 20425.718750, 20361.816406, 20249.511719, &
              20087.085938, 19874.025391, 19608.572266, 19290.226563, 18917.460938, 18489.707031, &
              18006.925781, 17471.839844, 16888.687500, 16262.046875, 15596.695313, 14898.453125, &
              14173.324219, 13427.769531, 12668.257813, 11901.339844, 11133.304688, 10370.175781, &
               9617.515625,  8880.453125,  8163.375000,  7470.343750,  6804.421875,  6168.531250, &
               5564.382813,  4993.796875,  4457.375000,  3955.960938,  3489.234375,  3057.265625, &
               2659.140625,  2294.242188,  1961.500000,  1659.476563,  1387.546875,  1143.250000, &
                926.507813,   734.992188,   568.062500,   424.414063,   302.476563,   202.484375, &
                122.101563,    62.781250,    22.835938,     3.757813,     0.000000,     0.000000  /

       data b125/ 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000,       &
                  0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000,       &
                  0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000,       &
                  0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000,       &
                  0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000,       &
                  0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000,       &
                  0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000,       &
                  0.000000, 0.000007, 0.000024, 0.000059, 0.000112, 0.000199,       &
                  0.000340, 0.000562, 0.000890, 0.001353, 0.001992, 0.002857,       &
                  0.003971, 0.005378, 0.007133, 0.009261, 0.011806, 0.014816,       &
                  0.018318, 0.022355, 0.026964, 0.032176, 0.038026, 0.044548,       &
                  0.051773, 0.059728, 0.068448, 0.077958, 0.088286, 0.099462,       &
                  0.111505, 0.124448, 0.138313, 0.153125, 0.168910, 0.185689,       &
                  0.203491, 0.222333, 0.242244, 0.263242, 0.285354, 0.308598,       &
                  0.332939, 0.358254, 0.384363, 0.411125, 0.438391, 0.466003,       &
                  0.493800, 0.521619, 0.549301, 0.576692, 0.603648, 0.630036,       &
                  0.655736, 0.680643, 0.704669, 0.727739, 0.749797, 0.770798,       &
                  0.790717, 0.809536, 0.827256, 0.843881, 0.859432, 0.873929,       &
                  0.887408, 0.899900, 0.911448, 0.922096, 0.931881, 0.940860,       &
                  0.949064, 0.956550, 0.963352, 0.969513, 0.975078, 0.980072,       &
                  0.984542, 0.988500, 0.991984, 0.995003, 0.997630, 1.000000 /

      select case (km)

        case (24)

          ks = 5     
          do k=1,km+1
            ak(k) = a24(k)
            bk(k) = b24(k)
          enddo

#ifdef MARS_GCM
       case (28)
          ks = 4     
          do k=1,km+1
            ak(k) = a28(k)
            bk(k) = b28(k)
          enddo

       case (36)
          ks = 10     
          do k=1,km+1
            ak(k) = a36(k)
            bk(k) = b36(k)
          enddo
#endif MARS_GCM 


        case (32)
!         ks = 11              ! John Wilson's setup
          ks = 13              ! high-res trop_32 setup
          do k=1,km+1
            ak(k) = a32(k)
            bk(k) = b32(k)
          enddo
!miz
        case (33)
          ks = 7
          do k=1,km+1
            ak(k) = a33(k)
            bk(k) = b33(k)
          enddo
!miz
        case (48)
          ks = 28
          do k=1,km+1
#ifdef SCM
            ak(k) = a48x(k)
            bk(k) = b48x(k)
#else
            ak(k) = a48(k)
            bk(k) = b48(k)
#endif
          enddo

        case (55)
          ks = 41
          do k=1,km+1
            ak(k) = a55(k)
            bk(k) = b55(k)
          enddo

        case (60)
          ks = 37
          do k=1,km+1
            ak(k) = a60(k)
            bk(k) = b60(k)
          enddo
        
        !yzheng
        case (61)
          ks = 7
          do k=1,km+1
            ak(k) = a61f(k)
            bk(k) = b61f(k)
          enddo

        case (63)
          !Used for fvGFS
          ! GFS L64 equivalent setting
          ks = 23
          do k=1,km+1
            ak(k) = a63(k)
            bk(k) = b63(k)
          enddo

        case (64)
          ks = 46
          do k=1,km+1
            ak(k) = a64(k)
            bk(k) = b64(k)
          enddo

        case (100)
          ks = 38
          do k=1,km+1
            ak(k) = a100(k)
            bk(k) = b100(k)
          enddo

        case (101)
          ks = 0
          do k=1,km+1
            ak(k) = a101(k)
            bk(k) = b101(k)
          enddo

        case (125)
          ks = 33
          do k=1,km+1
            ak(k) = a125(k)
            bk(k) = b125(k)
          enddo


        case (203)
          ks = 1
          do k=1,km+1
            ak(k) = a203(k)
            bk(k) = b203(k)
          enddo

        case (10)
!--------------------------------------------------
! Pure sigma-coordinate with uniform spacing in "z"
!-------------------------------------------------0
!
         pt = 2000.           ! model top pressure (pascal)
         press(1) = pt
         press(km+1) = p0
         dlnp = (log(p0) - log(pt)) / real(km)

            lnpe = log(press(km+1))
         do k=km,2,-1
            lnpe = lnpe - dlnp
            press(k) = exp(lnpe)
         enddo

! Search KS
            ks = 0
         do k=1,km
            if(press(k) >= pc) then
               ks = k-1
               goto 123
            endif
         enddo
123   continue

         if(ks /= 0) then
            do k=1,ks
               ak(k) = press(k)
               bk(k) = 0.
            enddo                                                
          endif                                                

             pint = press(ks+1)
          do k=ks+1,km                                        
             ak(k) =  pint*(press(km)-press(k))/(press(km)-pint)               
             bk(k) = (press(k) - ak(k)) / press(km+1)          
          enddo                                                
             ak(km+1) = 0. 
             bk(km+1) = 1.                                     
                                                              
          do k=2,km
!            bk(k) = real(k-1) / real(km)
!            ak(k) = pt * ( 1. - bk(k) )
          enddo

             ak(km+1) = 0.
             bk(km+1) = 1.

        case default

!-----------------------------------------------------------------
! Pure sigma-coordinate with uniform spacing in sigma and ptop = 0
!-----------------------------------------------------------------
         pt = 0.
         pint = pt
         ks = 0
             ak(1) = 0.
             bk(1) = 0.
 
          do k=2,km
             ak(k) = 0.
             bk(k) = real(k-1) / real(km)
          enddo
             ak(km+1) = 0.
             bk(km+1) = 1.
!--- fix the top at 1 mb
             ak(1) = 100.
!---
!         do k=1,km+1
!            write(*,*) k, ak(k), bk(k)
!         enddo

      end select

          ptop = ak(1)

 end subroutine set_eta

 subroutine check_eta(km, ks, ptop, ak, bk)

 use fv_pack,      only: master
 use fms_mod,      only: error_mesg,  FATAL

 implicit none

      integer,  intent(in)::  km           ! vertical dimension
      integer,  intent(in):: ks           ! number of pure p layers
      real, intent(in):: ak(km+1)
      real, intent(in):: bk(km+1)
      real, intent(in):: ptop         ! model top (Pa)
! local
      real dlp, ps_max
      integer  k

      ps_max = 0.

      do k=ks+1,km
         dlp = (ak(k)-ak(k+1))/(bk(k+1)-bk(k))
!        if ( master ) write(*,*) k, dlp*0.01
         ps_max = max( ps_max, dlp )
      enddo

      if ( master ) write(*,*) 'Check_eta: allowable min_ps (mb)=', ps_max*0.01
      if( ps_max > 450.E2 ) then
          call error_mesg('check_eta', 'invalid (a,b) in set_eta',FATAL)
      endif

 end subroutine check_eta

